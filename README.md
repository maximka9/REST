# User API

Это API для управления пользователями и задачами, разработанное с использованием FastAPI и SQLAlchemy. Приложение поддерживает аутентификацию, создание и управление задачами, а также использование ограничений на количество запросов.

## Требования

- Python 3.8 или выше
- Docker и Docker Compose (для работы с контейнерами)

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/maximka9/REST.git
   cd REST
2. Создайте и активируйте виртуальное окружение (рекомендуется):
   ```bash
   python -m venv venv
   source venv/bin/activate  # для Linux или MacOS
   venv\Scripts\activate  # для Windows
   3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   Создайте файл .env в корне проекта и добавьте следующие переменные окружения:
env
## Настройка окружения
Создайте файл .env в корне проекта и добавьте следующие переменные окружения:
POSTGRES_USER=user
POSTGRES_PASSWORD=password
POSTGRES_DB=user_api_db
JWT_SECRET=your_jwt_secret

## Запуск приложения

1. Запустите контейнеры с помощью Docker Compose:
   ```bash
   docker-compose up -d

## Выполнение запросов к API

После успешного запуска приложения вы можете выполнять запросы к API. По умолчанию API будет доступен по адресу `http://localhost:8000`. Все запросы должны включать заголовок `Authorization` с Bearer-токеном, полученным при аутентификации.

## Примеры запросов

## Функционал пользователя (User API)

В `app/api/user.py` реализованы следующие функции для управления пользователями: регистрация, авторизация, выход из системы, а также защита от частых запросов с использованием SlowAPI.

### Роуты

- **POST /register** — Регистрация нового пользователя.
  - **Описание**: Создает нового пользователя в базе данных, проверяя, существует ли уже пользователь с данным email. Если такой пользователь существует, возвращается ошибка с кодом 400.
  - **Запрос**:
    ```json
    {
      "name": "Имя пользователя",
      "email": "user@example.com",
      "password": "password"
    }
    ```
  - **Ответ**:
    ```json
    {
      "id": 1,
      "name": "Имя пользователя",
      "email": "user@example.com"
    }
    ```

- **POST /login** — Аутентификация пользователя.
  - **Описание**: Проверяет данные пользователя, сравнивая email и пароль. В случае успеха возвращает JWT-токен для аутентификации в будущем.
  - **Запрос**:
    ```json
    {
      "email": "user@example.com",
      "password": "password"
    }
    ```
  - **Ответ**:
    ```json
    {
      "access_token": "jwt_token",
      "token_type": "bearer"
    }
    ```

- **POST /logout** — Выход из системы.
  - **Описание**: Реализует выход пользователя, аннулируя текущий JWT-токен. Для защиты от частых запросов используется ограничение 100 запросов в минуту с использованием SlowAPI.
  - **Заголовок**:
    ```bash
    Authorization: Bearer <ваш-токен>
    ```
  - **Ответ**:
    ```json
    {
      "detail": "Successfully logged out"
    }
    ```

## Функционал задач (Task API)

Файл `app/api/task.py` содержит реализацию CRUD-операций для управления задачами. Все маршруты защищены JWT-аутентификацией и ограничены на 100 запросов в минуту с использованием SlowAPI.

### Роуты

- **POST /tasks/** — Создание новой задачи.
  - **Описание**: Создает новую задачу, привязывая её к текущему аутентифицированному пользователю.
  - **Запрос**:
    ```json
    {
      "title": "Название задачи",
      "description": "Описание задачи"
    }
    ```
  - **Ответ**:
    ```json
    {
      "id": 1,
      "title": "Название задачи",
      "description": "Описание задачи",
      "owner_id": 1
    }
    ```

- **GET /tasks/** — Получение списка задач пользователя.
  - **Описание**: Возвращает все задачи, принадлежащие текущему аутентифицированному пользователю.
  - **Ответ**:
    ```json
    [
      {
        "id": 1,
        "title": "Название задачи",
        "description": "Описание задачи",
        "owner_id": 1
      }
    ]
    ```

- **GET /tasks/{task_id}** — Получение конкретной задачи.
  - **Описание**: Возвращает задачу по её идентификатору, если она принадлежит текущему пользователю. Если задача не найдена, возвращает ошибку 404.
  - **Ответ**:
    ```json
    {
      "id": 1,
      "title": "Название задачи",
      "description": "Описание задачи",
      "owner_id": 1
    }
    ```

- **PUT /tasks/{task_id}** — Обновление задачи.
  - **Описание**: Обновляет информацию о задаче (название и описание) для текущего пользователя. Если задача не найдена, возвращается ошибка 404.
  - **Запрос**:
    ```json
    {
      "title": "Новое название задачи",
      "description": "Новое описание задачи"
    }
    ```
  - **Ответ**:
    ```json
    {
      "id": 1,
      "title": "Новое название задачи",
      "description": "Новое описание задачи",
      "owner_id": 1
    }
    ```

- **DELETE /tasks/{task_id}** — Удаление задачи.
  - **Описание**: Удаляет задачу, если она принадлежит текущему пользователю. Если задача не найдена, возвращается ошибка 404.
  - **Ответ**:
    ```json
    {
      "detail": "Task deleted"
    }
    ```

### Ограничение запросов

- Для всех маршрутов, связанных с задачами, реализовано ограничение на 100 запросов в минуту с использованием библиотеки SlowAPI, что помогает предотвратить перегрузку сервера частыми запросами.

